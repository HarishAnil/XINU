#include <xinu.h>#include <stdio.h>#include <string.h>#include <stdlib.h>/*---------------------------------------------------------------------------------------- * xhs_printprocstk - prints all the processes details with priority greater than specified *---------------------------------------------------------------------------------------- */shellcmd xsh_printprocstk (int nargs, char *args[]) {	if (nargs == 2 && strncmp(args[1], "--help", 7) == 0) {		printf("\nUsage: %s",args[0]);		printf("\nDescription:");		printf("\nThis command prints all the processes  with priority greater than priority specified by the user. it prints the process' id, name, priority, state, stack base, stack size, stack limit and the stack pointer. It accepts only one argument");	}	if (nargs > 2) {		fprintf(stderr, "%s: too many arguments\n", args[0]);		fprintf(stderr, "Try '%s --help' for more information\n",			args[0]);		return 1;	}	if(nargs == 2){		int i = 0, input_pri = atoi(args[1]);				struct procent *proc;		unsigned long *sp;		char *pstate[]	= {		/* names for process states	*/		"free ", "curr ", "ready", "recv ", "sleep", "susp ",		"wait ", "rtime"};		printf("\nPID\t\t\tName\t\t\tPriority\t\tState\t\t\tStack Base\t\tStackSize (bytes)\tStack Limit (bytes)\tStack Ptr");		for(i =0 ; i < NPROC; i++)		{			proc = &proctab[i];			if(proc->prstklen == 0)				continue;			if(proc->prprio > input_pri)			{				if(i == currpid)					asm("movl %%esp, %0\n" :"=r"(sp));				else					sp = (unsigned long *)proc->prstkptr;				printf("\n%-15d\t\t%-15s\t\t%-15d\t\t%-15s\t\t%-15X\t\t%-15d\t\t%-15d\t\t    %-15X",i,proc->prname,proc->prprio,pstate[(int)proc->prstate],proc->prstkbase,proc->prstklen, 65536,sp);			}		}	}	printf("\n");	return 0;}